buildscript {
    repositories {
        mavenCentral()
        maven { url 'https://jitpack.io' }
    }

    dependencies {
         classpath 'io.bitrise.gradle:remote-cache:1.+'
    }
}

import io.bitrise.gradle.cache.BitriseBuildCache
import io.bitrise.gradle.cache.BitriseBuildCacheServiceFactory

println('[BITRISE BUILD CACHE] Gradle Configuration loaded')

String bitriseBuildCacheWorkspaceID = "09a2975c69a510f7"
boolean isCI = System.getenv().containsKey("CI")
println('[BITRISE BUILD CACHE] isCI: ' + isCI)
buildCache {
    local {
        enabled = !isCI
    }
    registerBuildCacheService(BitriseBuildCache.class, BitriseBuildCacheServiceFactory.class)
    remote(BitriseBuildCache.class) {
        if (System.getenv('SP_BOSTON_BUILD_CACHE')) {
            endpoint = System.getenv('SP_BOSTON_BUILD_CACHE')
            println 'Using SP_BOSTON_BUILD_CACHE endpoint: ' + endpoint
        } else {
            endpoint = System.getenv('BITRISE_BUILD_CACHE_ENDPOINT') ?: 'grpcs://pluggable.services.bitrise.io'
            println 'Using BITRISE_BUILD_CACHE_ENDPOINT endpoint: '+ endpoint
        }
        
        authToken = bitriseBuildCacheWorkspaceID + ':' + System.getenv('BITRISE_BUILD_CACHE_AUTH_TOKEN')
        enabled = true
        push = isCI
        debug = false
        blobValidationLevel = 'warning'
    }
}
